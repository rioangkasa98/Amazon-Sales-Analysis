-- Add DayName column
ALTER TABLE transactions
ADD COLUMN DayName VARCHAR(20);

UPDATE transactions
SET DayName = DAYNAME(Date);

-- Add MonthName column
ALTER TABLE transactions
ADD COLUMN MonthName VARCHAR(20);

UPDATE transactions
SET MonthName = MONTHNAME(Date);

-- Add TotalRevenue column
ALTER TABLE transactions
ADD COLUMN TotalRevenue DECIMAL(10, 2) GENERATED ALWAYS AS (Price * Quantity) STORED;

SELECT *
FROM transactions
LIMIT 10;

-- Business Questions

-- Product Section
-- 1. What is the total revenue for each product?
SELECT
	ProductName,
    SUM(TotalRevenue) AS Total_Revenue
FROM
	transactions
GROUP BY 1
ORDER BY 2 DESC;

-- 2. Which product has the highest quantity sold?
SELECT
	ProductName,
    SUM(Quantity) as total_quantity
FROM
	transactions
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1;

-- 3. Which product generated the highest revenue?
SELECT 
	ProductName, 
    SUM(TotalRevenue) as total_revenue
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1;

-- 4. What is the average price per product sold?
SELECT 
	ProductName, 
    ROUND(AVG(price),2) AS average_price
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC;

-- Sales Section
-- 1. What is the total sales revenue by country?
SELECT 
	Country, 
    SUM(TotalRevenue) AS total_revenue
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC;

-- 2. What is the total number of products sold by month?
SELECT 
	MonthName, 
    SUM(Quantity) AS total_quantity
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC;

-- 3. What is the average quantity sold per transaction?
SELECT 
	ROUND(AVG(Quantity)) AS average_quantity
FROM 
	transactions;

-- 4. How do sales vary by month or season (using DayName)?
SELECT 
	MonthName, 
	SUM(TotalRevenue) AS total_sales
FROM 
	transactions
GROUP BY 1
ORDER BY FIELD(MonthName, 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');

-- 5. Which country has the highest total revenue?
SELECT 
	Country, 
    SUM(TotalRevenue) AS total_revenue
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1;

-- Customer Section
-- 1. Which customer generates the most revenue?
SELECT 
	CustomerNo, SUM(TotalRevenue) AS total_spent
FROM 
	transactions
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1;

-- 2. How many unique customers are there in the dataset?
SELECT 
	COUNT(DISTINCT CustomerNo) AS unique_customers
FROM 
	transactions;

-- 3. What is the average number of products bought per customer?
SELECT 
	CustomerNo, 
    ROUND(AVG(Quantity), 2) AS average_products_bought
FROM 
	transactions
GROUP BY 1;
